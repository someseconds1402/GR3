{"ast":null,"code":"import _regeneratorRuntime from\"D:/Don't Click Here/2022_2/code_2/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"D:/Don't Click Here/2022_2/code_2/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"D:/Don't Click Here/2022_2/code_2/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useRef,useState}from'react';import*as XLSX from'xlsx';import FadeIn from'../../../effect/FadeIn';import{insertSupplyAbilityAPI}from'../../../../service/userService';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ImportButton=function ImportButton(props){var fileInputRef=useRef(null);var _useState=useState(null),_useState2=_slicedToArray(_useState,2),selectedFile=_useState2[0],setSelectedFile=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),errorMessage=_useState4[0],setErrorMessage=_useState4[1];var handleImport=function handleImport(){fileInputRef.current.value=null;fileInputRef.current.click();};var handleFileChange=function handleFileChange(event){var file=event.target.files[0];var fileReader=new FileReader();fileReader.onload=function(e){var arrayBuffer=e.target.result;var data=new Uint8Array(arrayBuffer);var workbook=XLSX.read(data,{type:'array'});if(workbook.SheetNames.length===0){setErrorMessage('Invalid file format. Please select an Excel file.');setSelectedFile(null);return;}setSelectedFile(file);setErrorMessage('');};fileReader.readAsArrayBuffer(file);};var handleReadData=function handleReadData(){if(!selectedFile){return;}var fileReader=new FileReader();fileReader.onload=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var arrayBuffer,data,workbook,objectData,props,sheetName,worksheet,jsonData;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:arrayBuffer=e.target.result;data=new Uint8Array(arrayBuffer);_context.next=4;return XLSX.read(data,{type:'array'});case 4:workbook=_context.sent;objectData=[],props=[];// Đọc dữ liệu từ sheet đầu tiên (sheet index = 0)\nsheetName=workbook.SheetNames[0];worksheet=workbook.Sheets[sheetName];// Sử dụng XLSX.utils.sheet_to_json để chuyển đổi sheet thành mảng JSON\njsonData=XLSX.utils.sheet_to_json(worksheet,{header:1});if(jsonData.length>1){props=jsonData.shift();jsonData.forEach(function(e){var element={};props.forEach(function(prop,index){element[prop]=e[index];});objectData.push({pandemic_id:element.pandemic_id,province_id:element.province_id,supply_type_id:element.supply_type_id,supply_quantity:element.supply_quantity,ability:element.ability});});}insertSupplyAbilityAPI(objectData);// console.log(props,objectData);\ncase 11:case\"end\":return _context.stop();}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();fileReader.readAsArrayBuffer(selectedFile);// setTimeout(() => {\n//   alert('Đã xảy ra lỗi! \\nDữ liệu bạn tải lên gây xung đột với dữ liệu trong hệ thống.')\n// }, 1000);\n};var handleDelete=function handleDelete(){setSelectedFile(null);setErrorMessage('');};return/*#__PURE__*/_jsx(\"div\",{className:\"col-span-1\",children:/*#__PURE__*/_jsxs(FadeIn,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-8 mt-5\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-span-5 pl-4\",children:/*#__PURE__*/_jsx(\"h5\",{children:props.elementName})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-span-3\",children:/*#__PURE__*/_jsx(\"hr\",{})})]}),!selectedFile&&/*#__PURE__*/_jsx(\"button\",{className:\"border-solid border-2 border-gray-500 rounded-lg w-64 h-9 hover:bg-gray-300 ml-4\",onClick:handleImport,children:\"Th\\xEAm file\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",ref:fileInputRef,onChange:handleFileChange,style:{display:'none'}}),selectedFile&&/*#__PURE__*/_jsxs(\"div\",{className:\"\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Selected file: \",selectedFile.name]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-danger w-64 ml-4\",onClick:handleDelete,children:\"X\\xF3a\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-success w-64 ml-4 mt-2\",onClick:handleReadData,children:\"C\\u1EADp nh\\u1EADt d\\u1EEF li\\u1EC7u l\\xEAn h\\u1EC7 th\\u1ED1ng\"})]}),errorMessage&&/*#__PURE__*/_jsx(\"p\",{children:errorMessage})]})});};export default ImportButton;","map":{"version":3,"names":["React","useRef","useState","XLSX","FadeIn","insertSupplyAbilityAPI","jsx","_jsx","jsxs","_jsxs","ImportButton","props","fileInputRef","_useState","_useState2","_slicedToArray","selectedFile","setSelectedFile","_useState3","_useState4","errorMessage","setErrorMessage","handleImport","current","value","click","handleFileChange","event","file","target","files","fileReader","FileReader","onload","e","arrayBuffer","result","data","Uint8Array","workbook","read","type","SheetNames","length","readAsArrayBuffer","handleReadData","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","objectData","sheetName","worksheet","jsonData","wrap","_callee$","_context","prev","next","sent","Sheets","utils","sheet_to_json","header","shift","forEach","element","prop","index","push","pandemic_id","province_id","supply_type_id","supply_quantity","ability","stop","_x","apply","arguments","handleDelete","className","children","elementName","onClick","ref","onChange","style","display","name"],"sources":["D:/Don't Click Here/2022_2/code_2/client/src/components/subscreen/expert/importfile/ImportButton.jsx"],"sourcesContent":["import React, { useRef, useState } from 'react';\r\nimport * as XLSX from 'xlsx';\r\nimport FadeIn from '../../../effect/FadeIn';\r\nimport { insertSupplyAbilityAPI } from '../../../../service/userService';\r\n\r\nconst ImportButton = (props) => {\r\n  const fileInputRef = useRef(null);\r\n  const [selectedFile, setSelectedFile] = useState(null);\r\n  const [errorMessage, setErrorMessage] = useState('');\r\n\r\n  const handleImport = () => {\r\n    fileInputRef.current.value = null;\r\n    fileInputRef.current.click();\r\n  };\r\n\r\n  const handleFileChange = (event) => {\r\n    const file = event.target.files[0];\r\n    const fileReader = new FileReader();\r\n\r\n    fileReader.onload = (e) => {\r\n      const arrayBuffer = e.target.result;\r\n      const data = new Uint8Array(arrayBuffer);\r\n      const workbook = XLSX.read(data, { type: 'array' });\r\n\r\n      if (workbook.SheetNames.length === 0) {\r\n        setErrorMessage('Invalid file format. Please select an Excel file.');\r\n        setSelectedFile(null);\r\n        return;\r\n      }\r\n\r\n      setSelectedFile(file);\r\n      setErrorMessage('');\r\n    };\r\n\r\n    fileReader.readAsArrayBuffer(file);\r\n  };\r\n\r\n  const handleReadData = () => {\r\n    if (!selectedFile) {\r\n      return;\r\n    }\r\n\r\n    \r\n    const fileReader = new FileReader();\r\n    \r\n    fileReader.onload = async (e) => {\r\n      const arrayBuffer = e.target.result;\r\n      const data = new Uint8Array(arrayBuffer);\r\n      const workbook = await XLSX.read(data, { type: 'array' });\r\n      let objectData = [], props = [];\r\n\r\n      // Đọc dữ liệu từ sheet đầu tiên (sheet index = 0)\r\n      const sheetName = workbook.SheetNames[0];\r\n      const worksheet = workbook.Sheets[sheetName];\r\n\r\n      // Sử dụng XLSX.utils.sheet_to_json để chuyển đổi sheet thành mảng JSON\r\n      const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });\r\n\r\n      if(jsonData.length > 1){\r\n        props = jsonData.shift();\r\n        jsonData.forEach(e=>{\r\n          let element = {}\r\n          props.forEach((prop, index) => {\r\n            element[prop] = e[index];\r\n          })\r\n          objectData.push({\r\n            pandemic_id: element.pandemic_id,\r\n            province_id: element.province_id,\r\n            supply_type_id: element.supply_type_id,\r\n            supply_quantity: element.supply_quantity,\r\n            ability: element.ability,\r\n          })\r\n        })\r\n      }\r\n      insertSupplyAbilityAPI(objectData);\r\n      // console.log(props,objectData);\r\n    };\r\n\r\n    fileReader.readAsArrayBuffer(selectedFile);\r\n\r\n    // setTimeout(() => {\r\n    //   alert('Đã xảy ra lỗi! \\nDữ liệu bạn tải lên gây xung đột với dữ liệu trong hệ thống.')\r\n    // }, 1000);\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    setSelectedFile(null);\r\n    setErrorMessage('');\r\n  };\r\n\r\n  return (\r\n    <div className='col-span-1'>\r\n      <FadeIn>\r\n        <div className=\"grid grid-cols-8 mt-5\">\r\n          <div className=\"col-span-5 pl-4\"><h5>{props.elementName}</h5></div>\r\n          <div className=\"col-span-3\"><hr /></div>\r\n        </div>\r\n        {!selectedFile && \r\n          <button className=\"border-solid border-2 border-gray-500 rounded-lg w-64 h-9 hover:bg-gray-300 ml-4\" onClick={handleImport}>\r\n            Thêm file\r\n          </button>}\r\n        <input\r\n          type=\"file\"\r\n          ref={fileInputRef}\r\n          onChange={handleFileChange}\r\n          style={{ display: 'none' }}\r\n        />\r\n        {selectedFile && (\r\n          <div className=''>\r\n            <p>Selected file: {selectedFile.name}</p>\r\n            <button className=\"btn btn-danger w-64 ml-4\" onClick={handleDelete}>\r\n              Xóa\r\n            </button>\r\n            <button className=\"btn btn-success w-64 ml-4 mt-2\" onClick={handleReadData}>\r\n              Cập nhật dữ liệu lên hệ thống\r\n            </button>\r\n          </div>\r\n        )}\r\n        {errorMessage && <p>{errorMessage}</p>}\r\n      </FadeIn>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ImportButton;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}